# grpc

### 定义

gRPC 是一项进程间的通信技术，开源用来连接、调用、操作和调试分布式异构应用程序

gRPC使用protocol buffers作为接口定义语言来定义服务接口，服务间通信通过HTTP/2来进行

借助服务定义，可以生成服务器端代码，也就是服务器端骨架（skeleton）和客户端代码，也就是客户端存根（stub）

### 通信技术演化

#### 传统RPC

借助RPC，客户端代码能够像调用本地方法一样远程调用某个方法，传统RPC实现包括通用对象请求代理体系结构（common object request broker architecture, CORBA）和 Java远程方法调用（remote method invocation， RMI）。但是大多数传统RPC实现很复杂，因为它们构建在TCP协议上，妨碍互操作性，且存在大量规范限制

#### SOAP

简单对象访问协议（simple object access protocol， SOAP）是面对服务的架构（service-oriented architecture, SOA）中的标准通信技术，用于在服务之间交换基于XML的结构化数据，并且能够基于任意的底层通信协议进行通信。但消息格式的复杂性以及SOAP的各种规范的复杂性，妨碍了构建分布式应用程序的敏捷性。

#### REST

描述性状态迁移（representationnal state transfer, REST）架构是面向资源架构（resourece-oriented architecutre， ROA）的基础，在这种架构中，需要将分布式应用程序建模为资源集合，访问这些资源的客户端可以变更这些资源的状态（创建、读取、更新或删除）

REST的通用实现是HTTP，通过HTTP，可以将RESTful Web应用程序建模为能够通过唯一标识符访问的资源集合。应用于资源的状态变更操作会采用HTTP动词（GET\POST\PUT\DELETE\PATCH）的形式，资源的状态以文本格式来表述，如JSON\XML\HTML\YAML

局限性

1、基于文本的低效消息协议

RESTful服务建立在基于文本的传输协议上， 使用人类可读的文本格式，如JSON，事实上进行服务与服务之间通信时，通信双方不需要这种人类可读的文本化格式

2、应用程序之间缺乏强类型接口

服务通过网络进行交互，这些服务使用不同的语言来构建，缺乏明确定义和强类型的服务接口是使用RESTful服务的主要阻碍。在开发RESTful服务时，应用程序之间并不需要共享服务定义和类型定义的信息。

3、REST架构风格难以强制实施

REST架构的最佳实践并没有作为实现协议的一部分进行强制的要求，大多数RESTful的服务并没有遵循基础的REST架构风格

### grpc优势

#### 提供高效的进程间通信

基于protocol buffers的二进制协议进行客户端和服务端通信，能够更快地处理进程间的通信

#### 具有简单且定义良好的服务接口和模式

提供契约优先的方式，必须定义服务接口，才能去处理实现细节

#### 属于强类型

使用protocol buffers定义grpc服务，契约清晰定义了应用程序间进行通信所使用的类型

#### 支持多语言

基于protocol buffers 的服务定义是语言中立的，通过各个语言的grpc编译器插件可以生成多个语言的接口定义

#### 支持双工流

grpc在客户端和服务端都提供了对流的原生支持，开发流服务或流客户端非常容器。与REST服务消息风格相比，grpc的关键优势就是能够同时构建传统请求-响应风格的消息以及客户端流和服务端流

#### 内置特性

提供认证、加密、弹性、截止时间、超时、元数据交换、压缩、负载均衡、服务发现等功能特性

#### 与云原生生态系统集成

grpc是CNCF的一部分，CNCF下很多项目都支持使用grpc作为通信协议

### grpc劣势

#### grpc不适合面向外部的服务

grpc服务具有契约驱动、强类型的特点，限制向外部暴露的服务的灵活性，消费者的控制权会削弱很多

#### 巨大的服务定义变更是复杂的开发流程

出现巨大的grpc服务定义变更，需要重新生成客户端和服务端代码

#### grpc生态系统相对较小

与传统的REST或HTTP协议相比，浏览器和移动应用程序对grpc的支持处于初级阶段







